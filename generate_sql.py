
import json

data_str = """
[
{"id":"97f47d91-e7ba-4c79-8916-275b6658149b","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"archived_1768513747078_ARSP5_GMS_V1.1.7_20240919","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-15 21:47:55.115","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"Lotto Forte - POS 001","description":"BIU 01","activationCode":"LF-TTZ6-KCKXHY","deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 21:47:31.237","updatedAt":"2026-01-16 20:34:53.193"},
{"id":"cd01ef24-0d50-4eac-9226-c53671de3904","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"archived_1768516833834_ARSP5_GMS_V1.1.7_20240919","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-15 22:35:57.023","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"Lotto Forte - POS 015","description":"JAQUEIRA 05","activationCode":"LF-J56Z-RL91ZW","deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:35:29.46","updatedAt":"2026-01-16 20:35:19.517"},
{"id":"e13ddec1-d357-4aa0-81b4-836e671b4a64","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"archived_1768514335742_ARSP5_GMS_V1.1.7_20240919","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-15 21:56:11.476","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"Lotto Forte - POS 004","description":"BIU 04","activationCode":"LF-NGU6-MKXAD9","deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 21:55:52.908","updatedAt":"2026-01-16 20:34:55.417"},
{"id":"d5de4977-1f8a-4af0-a6da-cc0a6fce49d3","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"archived_1768514725930_ARSP5_GMS_V1.1.7_20240919","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-15 21:58:56.739","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"Lotto Forte - POS 005","description":"BIU 05","activationCode":"LF-8RZE-BLGQKV","deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 21:58:31.712","updatedAt":"2026-01-16 20:34:57.483"},
{"id":"8e5e3f38-cfa2-493f-8ca7-709da7d9873d","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"archived_1768514857384_ARSP5_GMS_V1.1.7_20240919","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-15 22:05:26.799","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"Lotto Forte - POS 006","description":"BIU 06","activationCode":"LF-TWF6-3ZUEKZ","deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:05:01.029","updatedAt":"2026-01-16 20:34:59.26"},
{"id":"a75110ce-8ff4-45e8-8a5f-2479432eec3a","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"archived_1768515173915_ARSP5_GMS_V1.1.7_20240919","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-15 22:07:38.342","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"Lotto Forte - POS 007","description":"BIU 07","activationCode":"LF-L4II-XL35U4","deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:06:58.223","updatedAt":"2026-01-16 20:35:01.549"},
{"id":"9ee2dd32-6efd-4dcd-af84-d39de6ced278","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"archived_1768515325442_ARSP5_GMS_V1.1.7_20240919","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-15 22:12:54.846","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"Lotto Forte - POS 008","description":"BIU 08","activationCode":"LF-MW0J-ZOCOB9","deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:12:24.503","updatedAt":"2026-01-16 20:35:03.709"},
{"id":"8cb51532-24e3-4c22-b350-0a8dcbace1ae","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"archived_1768515550427_ARSP5_GMS_V1.1.7_20240919","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-15 22:15:26.366","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"Lotto Forte - POS 009","description":"BIU 09","activationCode":"LF-KAEL-A1FDXW","deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:15:09.294","updatedAt":"2026-01-16 20:35:05.822"},
{"id":"262c3b5f-6b5e-43a8-955e-88338127cea1","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"archived_1768516163709_ARSP5_GMS_V1.1.7_20240919","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-15 22:19:11.375","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"Lotto Forte - POS 010","description":"BIU 10","activationCode":"LF-RMTF-B8QMS1","deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:18:45.98","updatedAt":"2026-01-16 20:35:09.864"},
{"id":"7537c47c-0e03-4789-b25f-30f1fd99dbf7","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"archived_1768516220068_ARSP5_GMS_V1.1.7_20240919","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-15 22:29:24.576","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"Lotto Forte - POS 011","description":"JAQUEIRA 01","activationCode":"LF-HHS3-G0E7S8","deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:28:59.046","updatedAt":"2026-01-16 20:35:12.433"},
{"id":"5c93490d-6a8a-45a5-8605-93eedcf6b495","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"archived_1768516407323_ARSP5_GMS_V1.1.7_20240919","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-15 22:30:22.676","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"Lotto Forte - POS 012","description":"JAQUEIRA 02","activationCode":"LF-ZPFS-RZFW9J","deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:29:53.174","updatedAt":"2026-01-16 20:35:14.131"},
{"id":"12fbc807-14c1-42ab-986c-506ccb32c6c9","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"archived_1768516456403_ARSP5_GMS_V1.1.7_20240919","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-15 22:33:28.187","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"Lotto Forte - POS 013","description":"JAQUEIRA 03","activationCode":"LF-UEEG-FGK9U0","deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:33:05.937","updatedAt":"2026-01-16 20:35:16.161"},
{"id":"38382f72-0193-49ca-916d-a370fa22b5b4","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"archived_1768516556056_ARSP5_GMS_V1.1.7_20240919","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-15 22:34:17.293","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"Lotto Forte - POS 014","description":"JAQUEIRA 04","activationCode":"LF-PTR9-WD2QO7","deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:33:59.183","updatedAt":"2026-01-16 20:35:17.841"},
{"id":"80f0dd5b-c0a7-4999-bcc7-38992a443fd8","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"archived_1768516991717_ARSP5_GMS_V1.1.7_20240919","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-15 22:40:35.089","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"Lotto Forte - POS 016","description":"JAQUEIRA 06","activationCode":"LF-XQBC-ZNVZ9H","deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:40:11.257","updatedAt":"2026-01-16 20:35:21.058"},
{"id":"26677957-e8da-419b-b729-7b942c142fa3","companyId":"8e9a4e60-9734-4cb8-8762-a62e4e8f327d","deviceId":"pending-IX-O2S4-X5TZWG","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-18 15:58:32.367","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"InnovareCode - POS 003","description":"","activationCode":"IX-O2S4-X5TZWG","deviceToken":null,"activatedAt":null,"isActive":false,"areaId":null,"createdAt":"2026-01-18 15:58:32.367","updatedAt":"2026-01-18 15:58:32.367"},
{"id":"d83778d2-ae89-4e13-b37f-67fb7000bec8","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"archived_1768671867225_ARSP5_GMS_V1.1.7_20240919","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-17 17:40:37.785","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"Lotto Forte - POS 002","description":"BIU 02","activationCode":"LF-6P80-MNAAR0","deviceToken":null,"activatedAt":"2026-01-17 17:40:36.868","isActive":false,"areaId":null,"createdAt":"2026-01-15 21:48:39.443","updatedAt":"2026-01-17 17:44:27.226"},
{"id":"e1f69bfd-4382-45f3-a532-cc4476e31a47","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"ARSP5_GMS_V1.1.7_20240919","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-17 18:00:19.178","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"Lotto Forte - POS 003","description":"BIU 03","activationCode":"LF-5NF1-FZGIRB","deviceToken":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkZXZpY2VJZCI6ImUxZjY5YmZkLTQzODItNDVmMy1hNTMyLWNjNDQ3NmUzMWE0NyIsImNvbXBhbnlJZCI6IjljODQ3ZTFhLTZlZWQtNDBjNS1iYzlhLTdiM2U3MWIzMzc1YiIsInR5cGUiOiJkZXZpY2UiLCJpYXQiOjE3Njg2NzE4NjcsImV4cCI6MTgwMDIwNzg2N30.y1mrzmy9Kp-54FI_xMURDGUrLXuP20bxqs8qBiC1mqE","activatedAt":"2026-01-17 17:44:27.231","isActive":true,"areaId":null,"createdAt":"2026-01-15 21:49:36.918","updatedAt":"2026-01-17 18:00:19.179"},
{"id":"2f7e6bc1-68a4-4a58-90ff-fbb60e1629c3","companyId":null,"deviceId":"cb9dd6624cdf0ff1","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-16 21:58:47.64","latitude":-9.6525433,"longitude":-35.7012651,"currentUserId":null,"lastUserId":null,"appVersion":"1.4.50 (170)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:01:36.586","updatedAt":"2026-01-16 21:58:47.641"},
{"id":"3a9835ee-e156-4390-9681-7a662b718441","companyId":null,"deviceId":"5ad5df615cf61304","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-15 21:47:08.403","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":"1.4.50 (170)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 21:47:08.403","updatedAt":"2026-01-15 21:47:08.403"},
{"id":"a44a0960-b47e-4c3f-9c84-59b003ccad19","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"8145173e66ff62ca","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-17 18:07:02.069","latitude":-9.5983187,"longitude":-35.6787304,"currentUserId":"092b8dc3-f231-41de-9217-c406074940b2","lastUserId":"092b8dc3-f231-41de-9217-c406074940b2","appVersion":"1.4.50 (170)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 21:46:51.57","updatedAt":"2026-01-17 18:07:02.07"},
{"id":"6ebf4e90-c68e-4631-a482-1dca65f4f474","companyId":null,"deviceId":"27f7cdd2b141b20f","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-15 22:11:42.687","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":"1.4.50 (170)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:11:42.687","updatedAt":"2026-01-15 22:11:42.687"},
{"id":"3bae48fd-947c-43f7-8fcf-b889a32cb7ca","companyId":null,"deviceId":"774d25953486588d","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-15 21:59:16.325","latitude":-9.6524891,"longitude":-35.7013113,"currentUserId":null,"lastUserId":null,"appVersion":"1.4.50 (170)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 21:58:15.53","updatedAt":"2026-01-15 21:59:16.326"},
{"id":"a3bfd907-c33c-474c-8fe5-e958cc4a2f03","companyId":null,"deviceId":"1364b2ca902256a7","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-15 21:53:33.638","latitude":-9.6525172,"longitude":-35.7013095,"currentUserId":null,"lastUserId":null,"appVersion":"1.4.50 (170)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 21:49:57.039","updatedAt":"2026-01-15 21:53:33.639"},
{"id":"427d66ee-a6a5-42e2-b4eb-7268caa07c53","companyId":null,"deviceId":"9da0fd9ae6c387c6","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-15 22:07:29.707","latitude":-9.6525631,"longitude":-35.7012094,"currentUserId":null,"lastUserId":null,"appVersion":"1.4.50 (170)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:06:28.024","updatedAt":"2026-01-15 22:07:29.708"},
{"id":"ecbf3def-e18d-4ff8-974a-2ac2c30e4361","companyId":null,"deviceId":"6f23ffdfd96997cd","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-15 22:18:33.172","latitude":-9.6529566,"longitude":-35.702973,"currentUserId":null,"lastUserId":null,"appVersion":"1.4.50 (170)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:18:31.931","updatedAt":"2026-01-15 22:18:33.174"},
{"id":"cbcbfe9b-8902-4c99-8f49-9fde4a737280","companyId":null,"deviceId":"e782ed37485dadeb","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-15 22:14:41.199","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":"1.4.50 (170)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 21:38:46.005","updatedAt":"2026-01-15 22:14:41.2"},
{"id":"798f6a2c-ee87-4304-a59f-283f31ee367b","companyId":null,"deviceId":"7972188a665d19a5","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-15 22:23:51.538","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":"1.4.50 (170)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:23:51.538","updatedAt":"2026-01-15 22:23:51.538"},
{"id":"9e28c483-d802-445c-8c59-d39d4c0ea6a6","companyId":null,"deviceId":"5e122d3c106e3fd5","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-15 22:26:42.643","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":"1.4.50 (170)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:26:42.643","updatedAt":"2026-01-15 22:26:42.643"},
{"id":"b92c4029-e781-4aec-9093-fe1551b50659","companyId":null,"deviceId":"e24b2448871ab346","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-15 22:32:53.526","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":"1.4.50 (170)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:32:53.526","updatedAt":"2026-01-15 22:32:53.526"},
{"id":"5543a3cb-bb14-4d20-8b9b-8d711582c69e","companyId":null,"deviceId":"279e67c7ca186895","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-15 22:30:03.459","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":"1.4.50 (170)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:30:03.459","updatedAt":"2026-01-15 22:30:03.459"},
{"id":"a6efe91e-a329-4e46-af07-ed5d82558778","companyId":null,"deviceId":"caacc4bdfdf07e68","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-15 22:40:03.304","latitude":-9.6525043,"longitude":-35.7012531,"currentUserId":null,"lastUserId":null,"appVersion":"1.4.50 (170)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:39:37.065","updatedAt":"2026-01-15 22:40:03.306"},
{"id":"737c66eb-6f93-4cbb-9021-1ea33ea01261","companyId":null,"deviceId":"d1ae2085ef234741","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-15 22:36:09.063","latitude":-9.6525096,"longitude":-35.7012183,"currentUserId":null,"lastUserId":null,"appVersion":"1.4.50 (170)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:35:08.281","updatedAt":"2026-01-15 22:36:09.065"},
{"id":"c0c2797d-d628-4ac0-b881-d332a4293c53","companyId":null,"deviceId":"b9c062125759ffe8","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-15 22:42:29.59","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":"1.4.50 (170)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:42:29.59","updatedAt":"2026-01-15 22:42:29.59"},
{"id":"8af5a499-6e5f-4d7b-9064-7827631ce2f6","companyId":null,"deviceId":"37acaee071076722","model":null,"status":"ONLINE","lastSeenAt":"2026-01-18 16:00:13.617","latitude":-5.9166729,"longitude":-35.2726025,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-18 16:00:13.618","updatedAt":"2026-01-18 16:00:13.618"},
{"id":"dde0e184-725a-47f3-9a14-150a2ffda968","companyId":"9c847e1a-6eed-40c5-bc9a-7b3e71b3375b","deviceId":"archived_1768595892812_ARSP5_GMS_V1.1.7_20240919","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-15 22:43:12.662","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"Lotto Forte - POS 017","description":"JAQUEIRA 07","activationCode":"LF-ESG8-TMPGAG","deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-15 22:42:42.047","updatedAt":"2026-01-16 20:39:36.841"},
{"id":"90322f3a-89c0-4828-8dff-4b350958f46e","companyId":null,"deviceId":"294808757e1cca86","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-18 15:59:46.11","latitude":-5.91657,"longitude":-35.272745,"currentUserId":null,"lastUserId":null,"appVersion":"1.4.70 (186)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-16 18:07:02.669","updatedAt":"2026-01-18 15:59:46.111"},
{"id":"2a1b9967-d7c7-46b9-b954-9ab14d53d3e8","companyId":"8e9a4e60-9734-4cb8-8762-a62e4e8f327d","deviceId":"ARSP5_GMS_V1.1.6_20230330","model":null,"status":"OFFLINE","lastSeenAt":"2026-01-18 16:01:06.992","latitude":null,"longitude":null,"currentUserId":null,"lastUserId":null,"appVersion":null,"name":"InnovareCode - POS 001","description":"","activationCode":"IX-2WZH-P9DZ3Q","deviceToken":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkZXZpY2VJZCI6IjJhMWI5OTY3LWQ3YzctNDZiOS1iOTU0LTlhYjE0ZDUzZDNlOCIsImNvbXBhbnlJZCI6IjhlOWE0ZTYwLTk3MzQtNGNiOC04NzYyLWE2MmU0ZThmMzI3ZCIsInR5cGUiOiJkZXZpY2UiLCJpYXQiOjE3Njg3NTIwNjUsImV4cCI6MTgwMDI4ODA2NX0.YiE5zAoj9A7wlc894n2F_coNVj06KbzOiQ639f1-s6g","activatedAt":"2026-01-18 16:01:05.728","isActive":true,"areaId":null,"createdAt":"2026-01-18 15:02:30.224","updatedAt":"2026-01-18 16:01:06.993"},
{"id":"e168cf0e-b701-4c29-a887-0828108dbd60","companyId":null,"deviceId":"0cc8ce2ef13d6791","model":"Android Device","status":"ONLINE","lastSeenAt":"2026-01-17 17:40:03.612","latitude":-9.5974444,"longitude":-35.675749,"currentUserId":null,"lastUserId":null,"appVersion":"1.4.50 (170)","name":null,"description":null,"activationCode":null,"deviceToken":null,"activatedAt":null,"isActive":true,"areaId":null,"createdAt":"2026-01-17 17:39:02.8","updatedAt":"2026-01-17 17:40:03.614"}
]
"""
data = json.loads(data_str)

columns = [
    "id", "companyId", "deviceId", "model", "status", "lastSeenAt", "latitude", "longitude",
    "currentUserId", "lastUserId", "appVersion", "name", "description", "activationCode",
    "deviceToken", "activatedAt", "isActive", "areaId", "createdAt", "updatedAt"
]

sql_statements = []

for entry in data:
    values = []
    for col in columns:
        val = entry.get(col)
        if val is None:
            values.append("NULL")
        elif isinstance(val, bool):
            values.append("TRUE" if val else "FALSE")
        elif isinstance(val, (int, float)):
            values.append(str(val))
        else:
            # Escape single quotes in strings
            cleaned_val = val.replace("'", "''")
            values.append(f"'{cleaned_val}'")
            
    # Append suffix to deviceId to ensure uniqueness if proper ID is present
    if "deviceId" in columns and "id" in columns:
        dev_id_idx = columns.index("deviceId")
        id_idx = columns.index("id")
        # Extract the original deviceId and id from the raw 'entry' dict, not 'values' list which has quotes
        original_dev_id = entry.get("deviceId")
        original_id = entry.get("id")
        
        if original_dev_id and original_id:
            # Create unique deviceId: "ORIGINAL_PREFIX-UUIDPART"
            unique_suffix = original_id.split('-')[0]
            new_dev_id = f"{original_dev_id}_{unique_suffix}"
            # Update the quoted value in the values list
            values[dev_id_idx] = f"'{new_dev_id}'"

            # IMPORTANT: ALSO update the UPDATE clause to use the new value? 
            # The UPDATE clause uses EXCLUDED."deviceId", which takes the value from VALUES.
            # So updating 'values' list is sufficient.

    values_str = ", ".join(values)
    
    # Prepare update clause for ON CONFLICT (Upsert)
    # We update all columns except 'id' which is the conflict target
    update_parts = [f'"{c}" = EXCLUDED."{c}"' for c in columns if c != "id"]
    update_clause = ", ".join(update_parts)

    # Using specific table name with schema as per user DDL and quoting column names
    columns_quoted = [f'"{c}"' for c in columns]
    sql = f'INSERT INTO "public"."PosTerminal" ({", ".join(columns_quoted)}) VALUES ({values_str}) ON CONFLICT ("id") DO UPDATE SET {update_clause};'
    sql_statements.append(sql)

with open("c:\\Projetos\\App\\InnoBet\\insert_pos_terminals.sql", "w", encoding="utf-8") as f:
    f.write("\n".join(sql_statements))

print("SQL script generated successfully.")
